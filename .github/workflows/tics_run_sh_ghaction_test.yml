name: TICS run self-hosted test (github-action)

on:
  workflow_dispatch: # Allows manual triggering

jobs:
  build:

    runs-on: stg-tiobe

    env:
      PATH: $HOME/TICS/Wrapper/BuildServer:$HOME/TICS/Wrapper/Client:$PATH
      TICS: "https://canonical.tiobe.com/tiobeweb/TICS/api/cfg?name=default"
      TICSPROJECT: "auto"
      
    steps:
    - name: Prepare the project
      run: |
           echo $TICS
           echo $TICSPROJECT
           echo $PATH
           
    - name: Checkout the project
      uses: actions/checkout@v4

    - name: Prepare the project
      run: |
           cd test

    - name: Run TICS analysis with github-action
      uses: tiobe/tics-github-action@v3
      with:
        mode: qserver
        project: testimage
        branchdir: .
        viewerUrl: https://canonical.tiobe.com/tiobeweb/TICS/api/cfg?name=default
        ticsAuthToken: ${{ secrets.TICSAUTHTOKEN }}
        installTics: false
